---
title: "Add sentiment columns"
author: "Sean Raleigh"
date: "July 17, 2017"
output: html_document
---

## Preliminaries

```{r}
library(tidyverse)
library(tidytext)
library(sotu)
library(readr)
library(ggplot2)
```


## Import data

```{r}
sou_df <- read_csv("DFExport2.csv")
```


## Tokenize and summarize

```{r, message = FALSE}
sou_df2 <- sou_df %>%
  mutate(text = map(text, as_data_frame), # unnest_tokens need data frame
         tokens = map(text, ~ unnest_tokens(.x, word, value)), # unnest
         count_before = map_int(tokens, ~ NROW(.x)), # count words
         tokens_stop = map(tokens,
            ~ anti_join(.x, stop_words)), # remove stopwords
         count_stop = map_int(tokens_stop, ~ NROW(.x)), # count words
         tokens_sent = map(tokens_stop,
            ~ inner_join(.x, get_sentiments("afinn"))), # sentiment analysis
         count_final = map_int(tokens_sent, ~ NROW(.x)), # count words
         count_final_pos = map_int(tokens_sent, 
            ~ NROW(filter(.x, score > 0))), # count positive words
         count_final_neg = map_int(tokens_sent, 
            ~ NROW(filter(.x, score < 0))), # count negative words
         score_pos = map_int(tokens_sent,
            ~ unlist(summarise(filter(.x, score > 0), sum(score)))),
         score_neg = map_int(tokens_sent,
            ~ unlist(summarise(filter(.x, score < 0), sum(score)))),
         net_score = score_pos + score_neg)
NROW(sou_df2)
```

## Graphs (finally)

```{r}
sou_graph_df <- sou_df2 %>% 
  filter(!(year == 1953 & birth_state == "Texas")) %>%
  filter(!(year == 1961 & birth_state == "Texas")) %>%
  filter(!(year == 1981 & birth_state == "Illinois" ))
  

```

```{r}
attach(sou_graph_df)
plot(year, net_score, main="Sentiment by year", 
  	xlab="Year", ylab="Sentiment Score")
```

```{r}
plot(year, count_final, main="Count Used for Analysis", 
  	xlab="Year", ylab="Final Count")
```

```{r}
sou_graph_df$perc_used <- (sou_graph_df$count_before / sou_graph_df$count_final)
perc_used <- sou_graph_df$perc_used
```

```{r}
plot(year, perc_used, main="Percent of Words used for Analysis", 
  	xlab="Year", ylab="Percent")
```








